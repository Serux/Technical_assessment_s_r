# Technical_assessment_s_r
This is a technical assessment, with the objective to create two interconected solutions:
- A REST API made in Python
- A CLI made in C#

The solutions needs to:
- Be containerized using Docker 
- Have a good performance to handle large datasets
- code quality, documentation, testing, security, and performance.

# Contents
## IMPORTANT
The CLI is executed in a docker container. For the CLI to be able to read files json from the host, `files to process need to be added to the files folder`. 
This folder id a docker volume, synchronized with the docker container, so the docker container can read files from this folder.
## Quick start
- To run the project, `Docker` and `Docker-compose` are required.

From the root folder, execute:
```bash
docker-compose build
```

To start the system, execute:
```bash
docker-compose up
```
If there is no previous MongoDB docker image, it will be downloaded at this point and system will start running.
(If you want it to run in the background to be able to use the same terminal, use the -d parameter at the end)

Enter in your browser : [http://127.0.0.1:8000/docs#/](http://127.0.0.1:8000/docs#/) or [http://localhost:8000/docs#/](http://localhost:8000/docs#/) to access the OpenAPI interface.

To execute the CLI execute the following command:
```bash
docker-compose run vulnerability-cli --file /files/ten_elements.json --url http://api:8000/ 
```
Where:
- --file : File to read. `For the docker container to be able to reach this file, you should copy it before in the "files" folder and the path needs to start with /files/.`
- --url  : URL to the api. For the docker container to be able to reach the api, the url must be http://api:8000/ .

The CLI will read the JSON file, POST it to the API and store it into the MondoDB database.

When you are finished, to stop and remove the containers:
```bash
docker-compose down
```
To start only one of the containers, you can use:
```bash
docker-compose up api
docker-compose up vulnerability-cli
docker-compose up mongodb
```
## Tests 
### API Tests
//TODO Not all functions on the API have tests. 
//TODO There is no automated cleanup functions (or Mocks) for tests to have repetible results

The testing of the api can be executed by:
```bash
docker-compose up api-test --build
```
To repeat the tests, you can:
```bash
docker-compose down
```
Then, delete the folder "database" and execute again. 

Sometimes there can be a problem with the container trying to connect to a deleted network, adding the parameter `--force-recreate` solves the problem.
```bash
docker-compose up api-test --build --force-recreate
```
### CLI Tests
//TODO Not all Functionality of CLI is tested
//TODO Tests of CLI executes directly the dll, but dividing the code in functions and testing them might give better test results.

The tests can be executed by:
```bash
docker-compose up cli-test --build --force-recreate
```



## System structure
The system has the following main elements:
- API REST in the folder "api".
- - Made with FASTAPI
- - pymongo to connecto to MongoDB
- - pydantic for security to validate parameters  
- - formatted python logging in file, with one new file per day.
- - security has been checked with "bandit", a python vulnerability scanner.
- C# CLI, in the folder "cli" 
- - Made with System.CommandLine for managing command line parameters.
- - Corvus (https://github.com/corvus-dotnet/Corvus.JsonSchema) for generating automatically the Models from a json schema and for validating JSON (More info in cli/corvus.txt).
- - Serilog for logging, with one new file per day.
- - Async calls to the API for improved performance with large datasets.
- MongoDB database, in the folder "database"
- - Selected as a NoSQL database for improved performance with large datasets.
- Docker-Compose to manage docker containers orquestration.


## Main folder structure
```
Technical_Assessment_s_r
│  compose.yaml       # Docker-compose with the orquestration of the project
│    
└─── api              # FastAPI Solution 
│   └─── logs         # Folder with persistent api logs 
│   └─── src          # Folder with the API code
│
└─── cli              # C# Solution
│   └─── logs         # Folder with persistent cli logs 
│   └─── src          # Folder with the CLI code
│       └─── models   # Models for parsing the JSON data, autogenerated with corvus-dotnet.
|
└─── database         # Folder for MongoDB persistency 
│
└─── files            # Folder for JSON files for the cli, this folder is shared with the cli Docker container
```


